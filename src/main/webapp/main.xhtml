<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Веб - Лаба 3</title>
    <h:outputStylesheet name="css/clock.css"/>
    <h:outputStylesheet name="css/header.css"/>
    <h:outputStylesheet name="css/main.css"/>
    <h:outputScript name="js/main.js"/>
</h:head>

<h:body>
    <header>
        <h1>Веб-программирование, Лабораторная работа №3, Вариант 49603</h1>
        <h2>Есоян Владимир Саркисович, P3208</h2>
    </header>
    <main>
        <h:form id="form-to-index" styleClass="buttons-container">
            <h:commandButton value="Стартовая страница" styleClass="default-button" action="go-index" id="go-index-button"/>
        </h:form>
        <br/>

        <h:form id="form">
            <div id="baseForm">
                <span>Укажите X:</span>
                <p:spinner id="x" value="#{inputBean.x}" min="-5" max="5" step="1" required="true" />
                <br/>
                <h:message for="x" id="xMessage" style="color:red" />
                <span>Укажите Y:</span>
                <div class="yText">
                    <h:inputText
                            id="y"
                            value="#{inputBean.y}"
                            decimalSeparator="."
                            required="true"
                            requiredMessage="Введите Y"
                            validatorMessage="Значение Y должно быть в пределах от -3 до 3"
                            converterMessage="Значение Y должно быть целым или дробным числом">
                        <f:validateDoubleRange minimum="-3.0" maximum="3.0"/>
                    </h:inputText>
                    <h:message for="y" style="color:red"/>
                </div>
                <span>Укажите R:</span>
                <div class="rText">
                    <h:inputText
                            id="r"
                            value="#{inputBean.r}"
                            decimalSeparator="."
                            required="true"
                            requiredMessage="Введите R"
                            validatorMessage="Значение R должно быть в пределах от 1 до 4"
                            converterMessage="Значение R должно быть целым или дробным числом"
                            onkeyup="updateSVG()">
                        <f:validateDoubleRange minimum="1.0" maximum="4.0"/>
                    </h:inputText>
                    <br/>
                    <h:message for="r" style="color:red"/>
                </div>
                <h:commandButton id="submitButton" actionListener="#{requestBean.process(false)}" value="Отправить" styleClass="default-button">
                    <f:ajax execute="@form" render="@form"/>
                </h:commandButton>
            </div>

            <h:form id="graphForm">
                <h:inputHidden id="xGraph" value="#{inputBean.XGraph}" />
                <h:inputHidden id="yGraph" value="#{inputBean.YGraph}" />
                <div id="graphContainer" onclick="sendCoordinates(event)">
                    <svg id="circles" fill="none" xmlns="http://www.w3.org/2000/svg"/>
                    <object type="image/svg+xml" data="resources/images/coordinates.svg" id="coordinateAxes"/>
                    <object type="image/svg+xml" data="resources/images/graph.svg" id="graph"/>
                </div>
                <h:commandButton id="submit" actionListener="#{requestBean.process(true)}">
                    <f:ajax execute="@form"/>
                </h:commandButton>
            </h:form>
        </h:form>
        <div class="formArea">
            <h:dataTable id="resultTable" value="#{resultRepository.resultsList}" var="r" styleClass="resultTable">
                <h:column>
                    <f:facet name="header">X</f:facet>
                    <h:outputText value="#{r.x}">
                        <f:convertNumber maxFractionDigits="4"/>
                    </h:outputText>
                </h:column>
                <h:column>
                    <f:facet name="header">Y</f:facet>
                    <h:outputText value="#{r.y}">
                        <f:convertNumber maxFractionDigits="4"/>
                    </h:outputText>
                </h:column>
                <h:column>
                    <f:facet name="header">R</f:facet>
                    <h:outputText value="#{r.r}">
                        <f:convertNumber maxFractionDigits="4"/>
                    </h:outputText>
                </h:column>
                <h:column>
                    <f:facet name="header">Попадание</f:facet>
                    <h:outputText value="#{r.result ? 'Попал' : 'Не попал'}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">Время запроса</f:facet>
                    <h:outputText value="#{r.createdAt}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">Время выполнения (нс)</f:facet>
                    <h:outputText value="#{r.executionTime}"/>
                </h:column>
            </h:dataTable>

            <p:poll interval="1" listener="#{resultRepository.refreshResults}" update="resultTable" keepAlive="true" oncomplete="updateSVG()"/>
            <h:form>
                <h:commandButton actionListener="#{resultRepository.removeResults()}" value="Очистить таблицу" styleClass="default-button">
                    <f:ajax execute="@form" render="resultTable"/>
                </h:commandButton>
            </h:form>
        </div>
    </main>
</h:body>
</html>